# ğŸš€ Kubernetes Health Checks (Liveness & Readiness)

> Production-grade examples of **Liveness** and **Readiness** probes using
> **exec**, **HTTP**, and **TCP** methods with real YAML manifests.

---

## ğŸ“‘ Table of Contents

* What are Probes?
* Liveness vs Readiness
* Architecture Diagram
* Probe Types
* YAML Examples
* Deployment Order
* Verification Commands
* Failure Scenarios
* Best Practices

---

## ğŸ§  What are Kubernetes Probes?

Kubernetes probes allow the **kubelet** to check container health.

| Probe Type    | Purpose                                  |
| ------------- | ---------------------------------------- |
| **Liveness**  | Is the container alive? If not â†’ restart |
| **Readiness** | Is the container ready to serve traffic? |
| **Startup**   | Is the app finished starting?            |

---

## ğŸ” Liveness vs Readiness (Real Meaning)

```
Liveness  â†’ restart container
Readiness â†’ remove pod from Service endpoints
```

| Scenario     | Liveness  | Readiness    |
| ------------ | --------- | ------------ |
| App crashed  | âŒ restart | âŒ no traffic |
| DB down      | âœ… running | âŒ no traffic |
| Slow startup | âŒ restart | âŒ no traffic |

---

## ğŸ—ï¸ Architecture Diagram â€“ Probe Flow

![Image](https://developers.redhat.com/sites/default/files/blog/2020/07/Probes-Example4-Solution.png)

![Image](https://cdn.prod.website-files.com/635e4ccf77408db6bd802ae6/6716204cc887a70bfc5c063e_AD_4nXdzBlMJxmsQsOnfVyAt-q-kyyPfQ2jyed2JrLNeDdIwMVIj9PKqP8eqhLGpOa_Wvh7bQgA4GBSdDxaq1PoDHtF0hBBeeieuOfIQTpuMN4iVQcMChAeB8lhifZ26_5B6uXhWDxDQSRodnYqOLdoP6gcFkI6isWiedFes2YESFg.gif)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Service    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ (only Ready pods)
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pod                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€ Container â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Liveness Probe           â”‚ â”‚
â”‚ â”‚ Readiness Probe          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
        Kubelet
```

---

## ğŸ”§ Probe Types Supported

| Probe     | Method | Example Use         |
| --------- | ------ | ------------------- |
| Liveness  | exec   | Check process/file  |
| Liveness  | HTTP   | App health endpoint |
| Liveness  | TCP    | DB / socket check   |
| Readiness | HTTP   | API ready check     |

---

## ğŸ“¦ YAML Examples

---

### ğŸ”¹ 1. Liveness Probe â€“ Command (`liveness-command.yml`)

```yaml
livenessProbe:
  exec:
    command:
    - cat
    - /tmp/healthy
  initialDelaySeconds: 10
  periodSeconds: 5
```

âœ” Used when:

* Checking file existence
* Checking running process
* Lightweight checks

---

### ğŸ”¹ 2. Liveness Probe â€“ HTTP (NGINX) (`liveness-http-nginx.yml`)

```yaml
livenessProbe:
  httpGet:
    path: /
    port: 80
  initialDelaySeconds: 5
  periodSeconds: 10
```

âœ” Best for:

* Web servers
* REST APIs

---

### ğŸ”¹ 3. Liveness Probe â€“ HTTP Failure (`liveness-http-error.yml`)

```yaml
livenessProbe:
  httpGet:
    path: /healthz
    port: 8080
  failureThreshold: 3
```

âŒ If endpoint returns **500 / timeout** â†’ container restarts

---

### ğŸ”¹ 4. Liveness Probe â€“ TCP (`liveness-tcp.yml`)

```yaml
livenessProbe:
  tcpSocket:
    port: 3306
  initialDelaySeconds: 15
  periodSeconds: 20
```

âœ” Ideal for:

* MySQL
* Redis
* Kafka
* Any TCP service

---

### ğŸ”¹ 5. Readiness Probe â€“ HTTP (`readness-http.yml`)

```yaml
readinessProbe:
  httpGet:
    path: /ready
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 5
```

âœ” Pod receives traffic **ONLY after this passes**

---

## ğŸš€ Apply Manifests

```bash
kubectl apply -f liveness-command.yml
kubectl apply -f liveness-http-nginx.yml
kubectl apply -f liveness-http-error.yml
kubectl apply -f liveness-tcp.yml
kubectl apply -f readness-http.yml
```

---

## ğŸ” Verification Commands (SRE Style)

```bash
kubectl get pods
kubectl describe pod <pod-name>
kubectl get events --sort-by=.metadata.creationTimestamp
```

Watch probe failures live:

```bash
kubectl logs <pod-name> --previous
```

---

## ğŸ’¥ Failure Scenarios (Important!)

| Failure             | Result                   |
| ------------------- | ------------------------ |
| Liveness fails      | Container restarts       |
| Readiness fails     | Pod removed from Service |
| Both fail           | Restart + no traffic     |
| Probe misconfigured | CrashLoopBackOff         |

---

## âœ… Best Practices (Production)

âœ” Always use **Readiness** with Services
âœ” Keep Liveness **lightweight**
âœ” Avoid DB checks in Liveness
âœ” Use StartupProbe for slow apps
âœ” Tune `initialDelaySeconds` carefully
âœ” Monitor with Prometheus alerts

---

## ğŸ§­ Real-World Recommendation

| App Type    | Recommended               |
| ----------- | ------------------------- |
| API         | HTTP Liveness + Readiness |
| Database    | TCP Liveness              |
| Legacy App  | exec probe                |
| Spring Boot | `/actuator/health`        |

---
